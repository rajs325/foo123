<!DOCTYPE html>
<html>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="height=device-height,width=device-width" />
<body onload="init();">

<!--
<img id="bgimage" src="parachute-background2.png" alt="The background" width="0" height="0" style="visibility:hidden;"/>
<img id="shipimage" src="ship1.png" alt="The Ship" width="0" height="0" style="visibility:hidden;"/>
<img id="planeimage" src="propeller-plane01.gif" alt="The plane" width="0" height="0" style="visibility:hidden;"/>
<img id="manimage" src="man1.png" alt="The man who jumps from the plane" width="0" height="0" style="visibility:hidden;"/>
<img id="splashimage" src="splash.png" alt="The splash" width="0" height="0" style="visibility:hidden;"/>
-->

<canvas id="myCanvas" width="1186" height="800" style="position:absolute; top:0;left:0; visibility: visible; z-index: 0; solid #c3c3c3;">your browser does not support the canvas tag </canvas>

<script type="text/javascript">
var bgimage = new Image();
bgimage.src = "parachute-background2.png";
var shipimage = new Image();
shipimage.src = "ship1.png";
var planeimage = new Image();
planeimage.src = "propeller-plane01.gif";
var manimage = new Image();
manimage.src = "man1.png";
var splashimage = new Image();
splashimage.src = "splash.png";

var ship_min    = 170;
var ship_max    = 900;
var shipx       = ship_min;
var shipy       = 508;
var shipwidth   = 173;
var shipheight  = 104;

var planexmax   = 1000;
var planexmin   = 20;
var planex      = planexmax;
var planey      = 18;
var planewidth  = 173;
var planeheight = 104;
var planeshift  = 10;

var bgx         = 0;
var bgy         = 300;
var bgwidth     = 1186;
var bgheight    = 353;

/* Specific plane positions at which man in a parachute can jump */
var plane_xpos = new Array(1000-50, 900-50, 800-50, 700-50, 600-50, 500-50, 400-50, 300-50);
var MAX_POSITIONS = plane_xpos.length;

var manVisible  = new Array();
var manx        = new Array();
var many        = new Array();
var manwidth    = 94;
var manheight   = 121;
var man_yrate   = 5;
var man_vrate   = 5;
var man_maxy    = 462;

var cx = 0;
var cy = 0;
var cwidth = 1186;
var cheight = 1024;

var splash_visible = 0;
var credits = 0;
var misses = 0;
var textx = 10;
var texty = 720;
var text_font = "30px Arial";

var leftmx = 340;
var leftmy = 640;
var leftmw = 200;
var leftmh =  50;

var rightmx = 600;
var rightmy = 640;
var rightmw = 200;
var rightmh =  50;

var mousex = 0;
var mousey = 0;

var ongoingTouches = new Array();
var oldtouchx = 0;
var oldtouchy = 0;
var touchx = 0;
var touchy = 0;
var ntouch = 0;

function init(){
  var el = document.getElementById("myCanvas");
  el.addEventListener("touchstart", handleStart, false);
  el.addEventListener("touchend", handleEnd, false);
  el.addEventListener("touchcancel", handleCancel, false);
  el.addEventListener("touchleave", handleEnd, false);
  el.addEventListener("touchmove", handleMove, false);
  setInterval(animate, 70);
}

function animate() {
  if(planex > planexmin) {
    planex -= planeshift;
  } else {
    planex = planexmax;
  }

  var index;
  var limit = plane_xpos.length;
  for(index = 0; index < limit; index++) {
    if(planex == plane_xpos[index]) {
      manVisible[index] = Math.floor((Math.random()*100)) % man_vrate == 0 ? 1 : 0;
      manx[index] = planex;
      many[index] = planey + planeheight;
    }
  }

  for(index = 0; index < limit; index++) {
    if(many[index] <= man_maxy) {
      many[index] = many[index] += man_yrate;
    } else {
      manVisible[index] = 0;
    }
    if(manVisible[index] == 1) {
      if((manx[index] > shipx) && manx[index] < (shipx + shipwidth)) {
        if(many[index] == man_maxy) {
          credits++;
        }
      } else if(many[index] == man_maxy) {
        misses++;
      }
    }
  }

  draw();
}

function draw(){
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");

  ctx.clearRect(cx,cy,cwidth,cheight);
  ctx.drawImage(bgimage, bgx, bgy, bgwidth, bgheight);
  ctx.drawImage(shipimage, shipx, shipy, shipwidth, shipheight);
  ctx.drawImage(planeimage, planex, planey, planewidth, planeheight);
  ctx.font = text_font;
  ctx.fillText("credits: " + credits.toString() + ", misses : " + misses.toString() +
    "x:" + touchx.toString() + ", y: " + ntouch.toString(), textx, texty);
  var index;
  var limit = plane_xpos.length;
  for(index = 0; index < limit; index++) {
    if(manVisible[index] == 1) {
      ctx.drawImage(manimage, manx[index], many[index], manwidth, manheight);
    }
  }
  ctx.fillStyle = "rgb(150,29,28)";
  ctx.fillRect(leftmx, leftmy, leftmw, leftmh);
  ctx.fillRect(rightmx, rightmy, rightmw, rightmh);
}
function handleKey(e){
  if(e.keyCode=='37'){
    if(shipx > ship_min) {
      shipx -= 20;
    }
  } else if(e.keyCode=='39') {
    if(shipx < ship_max) {
      shipx += 20;
    }
  }
  draw();
}
function handleMouseDown(e){
  mousex = e.pageX;
  mousey = e.pageY;
  if(mousex > leftmx && mousex < (leftmx + leftmw)) {
    if(mousey > leftmy && mousey < (leftmy + leftmh)) {
      if(shipx > ship_min) {
        shipx -= 20;
      }
    }
  }else if(mousex > rightmx && mousex < (rightmx + rightmw)) {
    if(mousey > rightmy && mousey < (rightmy + rightmh)) {
      if(shipx < ship_max) {
        shipx += 20;
      }
    }
  }
  draw();
}
function handleStart(evt) {
  evt.preventDefault();
  var el = document.getElementById("myCanvas");
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;
  var direction = 0;
  
  ntouch = touches.length;
  for (var i=0; i < ntouch; i++) {
    ongoingTouches.push(touches[i]);
    oldtouchx = touchx;
    oldtouchy = touchy;
    touchx = touches[i].pageX;
    touchy = touches[i].pageY;
    direction = (touchx - oldtouchx) > 0 ? 1 : -1;
    if(touchx > leftmx && touchx < (leftmx + leftmw)) {
      if(touchy > leftmy && touchy < (leftmy + leftmh)) {
        if(direction == -1 && shipx > ship_min) {
          shipx -= 20;
        } else if(direction == 1 && shipx < ship_max) {
          shipx += 20;
        }
      }
    //}else if(touchx > rightmx && touchx < (rightmx + rightmw)) {
    //  if(touchy > rightmy && touchy < (rightmy + rightmh)) {
    //    if(shipx < ship_max) {
    //      shipx += 20;
    //    }
    //  }
    }
  }
  draw();
}
function handleEnd(evt) {
}
function handleCancel(evt) {
}
function handleMove(evt) {
  handleStart(evt);
}
document.onkeydown=handleKey;
document.onmousedown=handleMouseDown

</script>

</body>
</html>
